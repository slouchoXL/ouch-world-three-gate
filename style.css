/* ===== Base site styles (kept minimal) =============================== */
:root{
  --bg:#000;
  --text:#d3d3d3;
  --muted:#757575;
  --chip:#111;
  --chip-border:#444;
}

*{ box-sizing:border-box }
html,body{ height:100% }
html, body { overscroll-behavior-x: none; }
body{
  margin:0; background:var(--bg); color:var(--text);
  font-family:ui-sans-serif,system-ui,-apple-system,Inter,Roboto,Arial,sans-serif;
  overflow:hidden;
}

/* Canvas fills screen */
#webgl{
  position:fixed; inset:0; display:block;
  width:100vw; height:100vh; max-width: 100vw;
}

/* Mobile input safety */
#webgl,#lanes{
  touch-action:none;
  -webkit-user-select:none; user-select:none;
}

/* Hover lanes */
#lanes{ position:fixed; inset:0; pointer-events:none; z-index:50; }
#lanes .lane{ position:absolute; top:0; bottom:0; pointer-events:auto; cursor:pointer; }

/* Footer (icons) */
.footer{
  position:fixed; left:0; right:0; bottom:12px;
  display:grid; grid-template-columns:repeat(var(--cols,3),1fr);
  justify-items:center; align-items:center; width:100vw;
  z-index:200; pointer-events:auto;
}
.footer .footer-icon{
  font-size:22px; width:44px; height:44px; border-radius:10px;
  border:none; background:transparent; color:var(--text);
  display:inline-flex; align-items:center; justify-content:center;
  cursor:pointer; transition:transform .15s ease, color .15s ease;
}
.footer .footer-icon svg{ width:22px; height:22px; display:block; fill:currentColor; }
.footer .footer-icon:hover{ color:#fff; transform:translateY(-1px); }
.footer .footer-icon:focus{ outline:2px solid #888; outline-offset:2px; }
.footer .footer-icon svg, .footer .footer-icon svg *{ fill:currentColor!important; stroke:currentColor!important; }

@media (hover:none){
  .footer{ visibility:hidden; }
  .footer.ready{ visibility:visible; }
  .footer .footer-icon{ color:#fff; -webkit-tap-highlight-color:transparent; }
  .footer .footer-icon svg{ width:20px; height:20px; transform:translateZ(0); }
}

/* Pills rail */
#pillsRail{
  position:fixed; bottom:62px; left:50%; transform:translateX(-50%) translateY(8px);
  z-index:210; background:var(--chip); border:none; border-radius:10px;
  box-shadow:0 10px 24px rgba(0,0,0,.35);
  display:inline-flex; flex-direction:column; align-items:stretch;
  width:min(160px,92vw); padding:6px;
  opacity:0; pointer-events:none; transition:opacity .15s ease, transform .15s ease;
}
#pillsRail::after{
  content:""; position:absolute; bottom:-6px; left:50%; transform:translateX(-50%);
  border-left:6px solid transparent; border-right:6px solid transparent; border-top:6px solid var(--chip);
  filter:drop-shadow(0 2px 0 rgba(0,0,0,.35));
}
#pillsRail.open{ opacity:1; pointer-events:auto; transform:translateX(-50%) translateY(0); }
#pillsRail .pill{
  display:inline-flex; align-items:center; gap:6px;
  background:transparent; color:var(--text); border:none; border-radius:8px;
  padding:.35rem .55rem; font-weight:600; font-size:13px; line-height:1.1;
  transition: background-color .12s ease, color .12s ease, transform .12s ease;
}
#pillsRail .pill + .pill{ margin-top:6px; }
#pillsRail .pill svg{ flex-shrink:0; display:block; fill:currentColor; }
#pillsRail .pill:hover{ background:rgba(255,255,255,.05); color:#fff; transform:translateY(-1px); }
#pillsRail .pill.active{ background:rgba(255,255,255,.08); color:#fff; }

@media (hover:none){
  #pillsRail{ width:min(160px,92vw); padding:8px; }
  #pillsRail .pill{ font-size:12.75px; padding:.32rem .5rem; }
}

/* Dim 3D when overlay open */
#webgl.dim-3d{ filter:grayscale(.7) brightness(.55) blur(1px); transition:filter .2s ease; }

/* Focus outlines */
.footer .footer-icon:focus, #pillsRail .pill:focus, .modal-close:focus{
  outline:2px solid #888; outline-offset:2px;
}

/* iOS safe-area */
@supports(padding:max(0px)){
  .footer{ bottom:calc(20px + env(safe-area-inset-bottom)); }
}

/* ===== Overlay (generic) ============================================= */
.modal{ position:fixed; inset:0; z-index:1000; background:rgba(0,0,0,.66); }
.modal[hidden]{ display:none; }
.modal-card{
  max-width:90%; margin:6vh auto; background:#0b0b0b; color:#fff;
  padding:15px; border-radius:12px; position:relative;
}
.modal-close{
  position:absolute; top:12px; right:16px; font-size:28px;
  background:none; border:0; color:#fff; cursor:pointer;
}

/* ===== Packs overlay (the one hosting <packs-widget>) ================= */

/* Host modal container: full center, no accidental margins */
.modal.modal--packs .modal-card{
  position:fixed; left:50%; top:50%; transform:translate(-50%,-50%);
  margin:0; padding:0;
  width:min(1100px, 92vw);
  height:min(92vh, 100svh);
  background:#0b0b0b; color:#fff; border-radius:12px;
  display:flex; flex-direction:column; overflow:hidden;
}

/* Body: center the widget and prevent sideways scroll */
.modal.modal--packs .modal-body{
  flex:1; display:flex; align-items:flex-start; justify-content:center;
  padding:16px; min-height:0; overflow:auto; overflow-x:hidden;
}

/* Make the custom element fill nicely */
.modal.modal--packs .modal-body > packs-widget{
  display:block; width:100%; max-width:1060px; margin:0 auto; overflow:hidden;
}


@media (max-width: 600px){
  packs-widget{
    --packW: 240px;   /* smaller pack on phones */
    --cardW: 200px;
    --trayCardW: 130px;
    --stagePad: 10px; /* keep tray away from edges */
    --actionsGap: 2px;/* CTA almost touching stage */
    --metaGap: 2px;   /* balance almost touching pack */
    --trayGapX: 8px;  /* slightly tighter grid */
    --trayGapY: var(--trayGapX);
  }
  /* reduce any default stage spacing from widget */
  packs-widget .card-stage{ margin-bottom:0 !important; }
}

/* ===== Widget-safe rules (no duplicates, no conflicting heights) ===== */

/* NEVER distort images */
packs-widget img{ max-width:100%; height:auto; }

/* Pack image: maintain ratio via aspect-ratio (no height calc needed) */
packs-widget .pack-img{
  width:var(--packW);
  aspect-ratio: 10 / 7 * 1;           /* 1400x2000 -> 2000/1400 = 10/7 â‰ˆ 1.4286 */
  object-fit:contain;
}

/* Cards & tray thumbs: enforce 5:7 ratio */
packs-widget .card-abs,
packs-widget .tray-card,
packs-widget .stage-modal-img{
  aspect-ratio: 5 / 7;
}
packs-widget .card-abs{
  width:var(--cardW);
}
packs-widget .tray-card{
  width:var(--trayCardW);
}

/* Card/tray images always cover their containers */
packs-widget .card-img,
packs-widget .tray-card img{
  width:100%; height:100%; object-fit:cover;
}

/* Tray layout uses variables for equal gaps + side padding */
packs-widget .tray-wrap{ padding-inline: var(--stagePad); }
packs-widget .tray-grid{
  column-gap: var(--trayGapX);
  row-gap: var(--trayGapY);
  justify-content:center;
}

/* Actions row sits close under the stage */
packs-widget .stage-actions{ margin-top: var(--actionsGap) !important; }

/* Price/balance block sits tight above the pack and stays centered */
packs-widget .pack-card,
packs-widget .pack-meta,
packs-widget .pack-topbar{
  margin-bottom: var(--metaGap) !important;
  text-align:center;
}

/* Prevent any sideways scroll anywhere in the modal/widget stack */
.modal, .modal-card, .modal-body, packs-widget{
  overscroll-behavior:contain;
  overflow-x:hidden;
}

/* ===== Packs overlay: center & contain ===== */
.modal.modal--packs {
  /* optional: no extra padding on the outer overlay */
  padding: 0;
}

.modal.modal--packs .modal-card{
  position: fixed;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);   /* perfect center */
  margin: 0;                          /* kill auto margins */
  padding: 0;                         /* IMPORTANT: no side padding */
  width: min(1100px, 92vw);           /* generous width, respects viewport */
  height: min(92vh, 100svh);          /* generous height */
  border-radius: 12px;
  display: flex;
  flex-direction: column;
  overflow: hidden;                   /* contain content */
  background: #0b0b0b;
  color: #fff;
  box-sizing: border-box;
}

/* Body fills the card and centers the widget */
.modal.modal--packs .modal-body{
  flex: 1;
  display: flex;
  justify-content: center;            /* horizontal centering */
  align-items: flex-start;            /* sit at top */
  padding: 0;                         /* IMPORTANT: no padding here */
  overflow-x: hidden;                 /* no side scroll */
  overflow-y: auto;
}

/* The widget element: full width but contained */
.modal.modal--packs .modal-body > packs-widget{
  display: block;
  width: 100%;
  max-width: 1060px;                  /* matches diagnose page */
  margin: 0 auto;
  overflow: hidden;
}

/* Mobile: make the modal full-screen, no rounding */
@media (max-width: 600px){
  .modal.modal--packs .modal-card{
    width: 100vw;
    height: 100svh;
    border-radius: 0;
  }
}
/* Tighten the action row under the stage (honor the var) */
.modal.modal--packs .modal-body packs-widget .stage-actions {
  margin-top: var(--actionsGap, 4px) !important;
}

/* Tighten the meta block above the pack (honor the var) */
.modal.modal--packs .modal-body packs-widget .pack-card,
.modal.modal--packs .modal-body packs-widget .pack-meta,
.modal.modal--packs .modal-body packs-widget .pack-topbar {
  margin-bottom: var(--metaGap, 4px) !important;
  text-align: center;
}

/* Equalize tray gaps & keep it centered (uses the vars we set inline) */
.modal.modal--packs .modal-body packs-widget .tray-grid {
  column-gap: var(--trayGapX, 12px) !important;
  row-gap:    var(--trayGapY, 12px) !important;
  justify-content: center !important;
}

/* Guard rails so nothing can squish or scroll sideways on mobile */
.modal.modal--packs,
.modal.modal--packs .modal-card,
.modal.modal--packs .modal-body,
.modal.modal--packs .modal-body packs-widget {
  overflow-x: hidden !important;
}
.modal.modal--packs .modal-body packs-widget img {
  max-width: 100%; height: auto;
}
.modal.modal--packs .modal-body packs-widget .card-img,
.modal.modal--packs .modal-body packs-widget .tray-card img {
  width: 100%; height: 100%; object-fit: cover;
}

/* --- Packs mobile spacing overrides (high specificity) --- */
@media (max-width: 600px){
  /* Kill any default bottom space under the stage */
  .modal.modal--packs .modal-body > packs-widget .card-stage{
    margin-bottom: 0 !important;
  }

  /* Button row immediately under the stage (support both class names) */
  .modal.modal--packs .modal-body > packs-widget .stage-actions,
  .modal.modal--packs .modal-body > packs-widget .tray-actions{
    margin-top: var(--actionsGap, -120px) !important;
  }

  /* Meta/balance block sits tight above the pack; cover multiple structures */
  .modal.modal--packs .modal-body > packs-widget .pack-card,
  .modal.modal--packs .modal-body > packs-widget .pack-meta,
  .modal.modal--packs .modal-body > packs-widget .header,
  .modal.modal--packs .modal-body > packs-widget .balance{
    margin-bottom: var(--metaGap, -80px) !important;
    text-align: center;
  }

  /* Tray grid gaps equalized */
  .modal.modal--packs .modal-body > packs-widget .tray-grid{
    column-gap: var(--trayGapX, 8px) !important;
    row-gap:    var(--trayGapY, 8px) !important;
    justify-content: center;
  }
}

.stage-shell{
  display:flex;
  flex-direction:column;
  align-items:center;
  gap: var(--actionsGap, 10px);   /* controls the button distance */
}
.stage-shell .card-stage{ margin-bottom: 0 !important; }
.stage-shell .stage-actions{ margin: 0 !important; }

@media (max-width: 600px){
  .stage-shell{ gap: 6px; }       /* nice tight mobile spacing */
}
